{% extends "base.html" %}

{% block head_title %}
{%- if profileView -%}
  @{{ profileView.Handle }} on Bluesky
{%- else -%}
  Bluesky
{%- endif -%}
{% endblock %}

{% block html_head_extra -%}
{%- if profileView -%}
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Bluesky Social">
  {%- if requestURI %}
  <meta property="og:url" content="{{ requestURI }}">
  {% endif -%}
  {%- if profileView.DisplayName %}
  <meta property="og:title" content="{{ profileView.DisplayName }} (@{{ profileView.Handle }})">
  {% else %}
  <meta property="og:title" content="{{ profileView.Handle }}">
  {% endif -%}
  {%- if profileView.Description %}
  <meta name="description" content="{{ profileView.Description }}">
  <meta property="og:description" content="{{ profileView.Description }}">
  {% endif -%}
  {%- if profileView.Banner %}
  <meta property="og:image" content="{{ profileView.Banner }}">
  <meta name="twitter:card" content="summary_large_image">
  {%- elif profileView.Avatar -%}
  {# Don't use avatar image in cards; usually looks bad #}
  <meta name="twitter:card" content="summary">
  {% endif %}
  <meta name="twitter:label1" content="Account DID">
  <meta name="twitter:value1" content="{{ profileView.Did }}">
  <meta name="twitter:site" content="@bluesky">
{% endif -%}
{%- endblock %}

{% block main_content %}
  {% if profileView.Banner %}
  <img src="{{ profileView.Banner }}" style="width: 100%;">
  <br>
  {% endif %}
  {% if profileView.DisplayName %}
  <h2>{{ profileView.DisplayName }}</h2>
  {% else %}
  <h2>{{ profileView.Handle}}</h2>
  {% endif %}
  <h3>@{{ profileView.Handle }}</h3>
  <p><code>{{ profileView.Did }}</code></p>
  <p>
    {{ profileView.FollowersCount }} followers |
    {{ profileView.FollowsCount }} following |
    {{ profileView.PostsCount }} posts
  </p>
  <p>{{ profileView.Description }}</p>

  <div class="ui divider"></div>
  <div class="ui feed">
  {% for feedItem in authorFeed %}
  <div class="event">
    <div class="label">
      {% if feedItem.Post.Author.Avatar %}
      <img src="{{ feedItem.Post.Author.Avatar }}">
      {% else %}
      <img src="/static/default-avatar.png">
      {% endif %}
    </div>
    <div class="content">
      {% if feedItem.Reason %}
        {{ feedItem.Reason.FeedDefs_ReasonRepost }}
      {% endif %}
      <div class="summary">
        <a href="/profile/{{ feedItem.Post.Author.Handle }}" class="user">
          {% if feedItem.Post.Author.DisplayName %}
          <b>{{ feedItem.Post.Author.DisplayName }}</b>
          {% endif %}
          @{{ feedItem.Post.Author.Handle }}
        </a>


        <div class="date">
          {# TODO: relative time#}
          {{ feedItem.Post.IndexedAt }}
        </div>
      </div>
      <div class="extra text">
        {{ feedItem.Post.Record.Val.Text }}
        {% if feedItem.Post.Embed and feedItem.Post.Embed.EmbedImages_View %}
        <div class="ui four cards">
          {% for image in feedItem.Post.Embed.EmbedImages_View.Images %}
          <div class="card">
            <div class="image">
              <a href="{{ image.Fullsize }}">
                <img alt="{{ image.Alt }}" src="{{ image.Thumb }}">
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      <div class="meta">
        <a class="like"><i class="reply icon"></i> {{ feedItem.Post.ReplyCount }}</a>
        <a class="like"><i class="comment outline icon"></i> {{ feedItem.Post.RepostCount }}</a>
        <a class="like"><i class="like outline icon"></i> {{ feedItem.Post.LikeCount }}</a>
      </div>
    </div>
  </div>
  <div class="ui divider"></div>
  {% endfor %}
  </div>
{%- endblock %}
